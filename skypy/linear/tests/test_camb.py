from astropy.cosmology import FlatLambdaCDM
from astropy.units import allclose, eV
import numpy as np
from skypy.linear.camb import camb

def test_camb():
  '''
  Test a FlatLambdaCDM cosmology with the default camb parameters
  '''
  camb_default_cosmology = FlatLambdaCDM(H0=67.5, Om0=(0.122+0.022)/(0.675*0.675), Tcmb0=2.7255, Ob0=0.022/(0.675*0.675), m_nu=[0.0, 0.0, 0.06]*eV)
  redshift = 0.0
  wavenumber = np.logspace(-4.0, np.log10(2.0), 200) # camb wavenumbers are kh
  pk = camb(wavenumber, redshift, camb_default_cosmology, 2.e-9, 0.965)
  assert allclose(pk, camb_direct_pk, rtol=1.e-4)

camb_direct_pk = np.array([[  271.62293938,   284.98264877,   298.99912192,   313.70458827,
                              329.13284042,   345.31931038,   362.30117929,   380.11746372,
                              398.80906621,   418.41886322,   438.99179405,   460.57496026,
                              483.2177605 ,   506.97200094,   531.89198254,   558.03461753,
                              585.45952579,   614.22916316,   644.40896822,   676.06750291,
                              709.27658895,   744.11145877,   780.65088301,   818.97732725,
                              859.1769977 ,   901.34003198,   945.56087275,   991.93843052,
                             1040.57589336,  1091.58095699,  1145.06628882,  1201.14971532,
                             1259.95410921,  1321.60762039,  1386.24378087,  1454.00177039,
                             1525.02677975,  1599.47019402,  1677.48918766,  1759.24705681,
                             1844.91371806,  1934.66588526,  2028.68656866,  2127.16540216,
                             2230.29882772,  2338.29032662,  2451.35021692,  2569.69585766,
                             2693.55108408,  2823.1464937 ,  2958.71916998,  3100.51283812,
                             3248.77697582,  3403.76695326,  3565.74258603,  3734.96838797,
                             3911.71232565,  4096.24589628,  4288.84219503,  4489.77588933,
                             4699.32031348,  4917.74768327,  5145.32696621,  5382.32348528,
                             5628.99465483,  5885.59000561,  6152.34778115,  6429.49426625,
                             6717.23797798,  7015.76972908,  7325.25904791,  7645.85287393,
                             7977.66858577,  8320.79364317,  8675.2806384 ,  9041.14558421,
                             9418.35908752,  9806.84600864, 10206.47848552, 10617.07419446,
                            11038.38388574, 11470.09222454, 11911.80759123, 12363.06221109,
                            12823.29819745, 13291.87081779, 13768.04001698, 14250.96349654,
                            14739.64367128, 15232.97631775, 15729.85410466, 16229.04783418,
                            16728.86602328, 17227.39224528, 17722.77006081, 18213.0973815 ,
                            18696.38207748, 19170.49158151, 19632.94622829, 20081.05868575,
                            20511.92513609, 20922.49548622, 21309.54401227, 21669.73600414,
                            21999.58620974, 22295.52083386, 22553.74840171, 22770.44322877,
                            22941.73773374, 23063.85095624, 23133.03594528, 23145.76977461,
                            23098.77584566, 22989.20306651, 22814.7170738 , 22573.64666054,
                            22265.18281354, 21889.4366548 , 21447.79600942, 20942.78980015,
                            20378.63499707, 19760.76750124, 19096.56945878, 18394.49960152,
                            17665.06050774, 16919.21569403, 16169.178774  , 15427.13289876,
                            14706.74221148, 14019.23424272, 13371.41676694, 12770.21939112,
                            12227.26932277, 11746.89042981, 11317.33722286, 10926.184515  ,
                            10562.01866632, 10210.72469733,  9855.63482341,  9476.75864575,
                             9050.03476594,  8560.17616751,  8007.51787931,  7409.30489019,
                             6795.52884755,  6199.66783077,  5654.0442239 ,  5187.09133001,
                             4817.16485991,  4541.6159017 ,  4332.42233955,  4144.29656634,
                             3930.89356578,  3663.25635112,  3342.95097079,  3000.00180639,
                             2682.03108292,  2433.90834162,  2263.38021025,  2137.44779718,
                             2009.72569584,  1844.90733992,  1652.808657  ,  1475.04508969,
                             1342.6839902 ,  1248.15427664,  1156.14076341,  1045.70851377,
                              934.90181172,   847.34507714,   778.72068284,   708.54079119,
                              635.76468201,   574.25975867,   522.68397756,   471.61507859,
                              424.08966944,   383.50223576,   345.6489032 ,   310.74299674,
                              279.95011259,   251.5659716 ,   226.00915695,   202.9473246 ,
                              182.04032673,   163.25078885,   146.28364733,   130.97986529,
                              117.19685625,   104.80075813,    93.6645652 ,    83.66636652,
                               74.69469625,    66.64851401,    59.43633535,    52.97590733,
                               47.19291903,    42.01986215,    37.39547348,    33.2641409 ]])