from astropy.cosmology import FlatLambdaCDM
from astropy.units import allclose
import numpy as np
from skypy.linear.camb import camb

def test_camb():

  camb_default_cosmology = FlatLambdaCDM(H0=67.5, Om0=0.122/(0.675*0.675), Tcmb0=2.7255, Ob0=0.022/(0.675*0.675))
  redshift = 0.0
  wavenumber = np.linspace(-4.0/0.675, np.log10(2.0)/0.675, 200)
  pk = camb(wavenumber, redshift, A_s=2.e-9, n_s=0.965, camb_default_cosmology)
  assert allclose(pk, camb_direct_pk)

camb_direct_pk = np.array([[3.96852829e+02, 4.16366522e+02, 4.36838639e+02, 4.58316071e+02,
        4.80847981e+02, 5.04485913e+02, 5.29283901e+02, 5.55298588e+02,
        5.82589314e+02, 6.11218241e+02, 6.41250489e+02, 6.72754274e+02,
        7.05801105e+02, 7.40465943e+02, 7.76827150e+02, 8.14966615e+02,
        8.54970173e+02, 8.96927791e+02, 9.40933505e+02, 9.87085568e+02,
        1.03548665e+03, 1.08624401e+03, 1.13946988e+03, 1.19528161e+03,
        1.25380153e+03, 1.31515715e+03, 1.37948145e+03, 1.44691314e+03,
        1.51759677e+03, 1.59168294e+03, 1.66932824e+03, 1.75069542e+03,
        1.83595367e+03, 1.92527885e+03, 2.01885344e+03, 2.11686669e+03,
        2.21951439e+03, 2.32699899e+03, 2.43952999e+03, 2.55732400e+03,
        2.68060431e+03, 2.80960097e+03, 2.94455050e+03, 3.08569594e+03,
        3.23328604e+03, 3.38757527e+03, 3.54882314e+03, 3.71729410e+03,
        3.89325601e+03, 4.07697997e+03, 4.26873850e+03, 4.46880531e+03,
        4.67745451e+03, 4.89495990e+03, 5.12159069e+03, 5.35761120e+03,
        5.60327998e+03, 5.85884860e+03, 6.12455616e+03, 6.40062874e+03,
        6.68727747e+03, 6.98469698e+03, 7.29305872e+03, 7.61251014e+03,
        7.94317200e+03, 8.28513634e+03, 8.63845903e+03, 9.00315847e+03,
        9.37921081e+03, 9.76654758e+03, 1.01650461e+04, 1.05745281e+04,
        1.09947515e+04, 1.14254090e+04, 1.18661162e+04, 1.23164117e+04,
        1.27757482e+04, 1.32434923e+04, 1.37189139e+04, 1.42011816e+04,
        1.46893131e+04, 1.51822091e+04, 1.56787638e+04, 1.61777792e+04,
        1.66776099e+04, 1.71763407e+04, 1.76721095e+04, 1.81630265e+04,
        1.86471085e+04, 1.91222461e+04, 1.95859935e+04, 2.00356814e+04,
        2.04684270e+04, 2.08811951e+04, 2.12707777e+04, 2.16338535e+04,
        2.19669474e+04, 2.22664964e+04, 2.25287304e+04, 2.27498301e+04,
        2.29259232e+04, 2.30532150e+04, 2.31279523e+04, 2.31465925e+04,
        2.31058269e+04, 2.30027519e+04, 2.28349764e+04, 2.26007507e+04,
        2.22991797e+04, 2.19302605e+04, 2.14952606e+04, 2.09965592e+04,
        2.04382307e+04, 1.98255438e+04, 1.91657315e+04, 1.84670793e+04,
        1.77399621e+04, 1.69952507e+04, 1.62451172e+04, 1.55016455e+04,
        1.47784702e+04, 1.40872519e+04, 1.34351478e+04, 1.28287000e+04,
        1.22793002e+04, 1.17929664e+04, 1.13588307e+04, 1.09642859e+04,
        1.05979613e+04, 1.02460633e+04, 9.89224680e+03, 9.51688873e+03,
        9.09601820e+03, 8.61291755e+03, 8.06619471e+03, 7.47140471e+03,
        6.85770435e+03, 6.25852937e+03, 5.70636277e+03, 5.23030751e+03,
        4.85020240e+03, 4.56589618e+03, 4.35181637e+03, 4.16379739e+03,
        3.95475944e+03, 3.69315419e+03, 3.37725243e+03, 3.03465498e+03,
        2.71177051e+03, 2.45532030e+03, 2.27791116e+03, 2.14949865e+03,
        2.02406557e+03, 1.86348696e+03, 1.67245032e+03, 1.49132570e+03,
        1.35396175e+03, 1.25697791e+03, 1.16634775e+03, 1.05744196e+03,
        9.45383937e+02, 8.55024392e+02, 7.85502794e+02, 7.16015464e+02,
        6.42817894e+02, 5.79891381e+02, 5.27822328e+02, 4.76777397e+02,
        4.28576745e+02, 3.87444242e+02, 3.49426881e+02, 3.14085621e+02,
        2.82958367e+02, 2.54339783e+02, 2.28479262e+02, 2.05202660e+02,
        1.84065257e+02, 1.65076559e+02, 1.47931738e+02, 1.32465414e+02,
        1.18534020e+02, 1.06002736e+02, 9.47440784e+01, 8.46353469e+01,
        7.55639799e+01, 6.74279332e+01, 6.01347823e+01, 5.36013642e+01,
        4.77526295e+01, 4.25204008e+01, 3.78428020e+01, 3.36636775e+01,
        2.99320204e+01, 2.66017406e+01, 2.36312647e+01, 2.09831278e+01,
        1.86236657e+01, 1.65226086e+01, 1.46526925e+01, 1.29893822e+01]])